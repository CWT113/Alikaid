# 进阶存储/引擎InnoDB引擎

## MySQL体系结构

![image.png](image/image6.png)

- **连接层：**最上层是一些客户端和链接服务，主要完成一些类似于连接处理、授权认证、及相关的安全方案。服务器也会为安全接入的每个客户端验证它所具有的操作权限。

- **服务层：**第二层架构主要完成大多数的核心服务功能，如SOL接口，并完成缓存的查询，SQL的分析和优化，部分内置函数的执行。所有跨存储引擎的功能也在这一层实现，如 过程、函数等。

- **引擎层：**存储引擎真正的负责了MySOL中数据的存储和提取，服务器通过AP和存储引擎进行通信。不同的存储引擎具有不同的功能，这样我们可以根据自己的需要，来选取合适的存储引擎。

- **存储层：**主要是将数据存储在文件系统之上，并完成与存储引擎的交互。



## 存储引擎简介

```SQL
-- 查询当前表的建表语句
show create table 表名;

-- 查看数据库所有存储引擎
show engines;

-- 创建表 my_myisam，存储引擎为 MyISAM
create table my_myisam(
    id int,
    name varchar(10)
) engine = MyISAM commit 'MyISAM表';
```

常见的存储引擎：

|Engine|Support|
|-|-|
|InnoDB|DEFAULT（默认）|
|MEMORY|YES|
|MyISAM|YES（InnoDB之前mysql使用的存储引擎）|



## 存储引擎特点

### InnoDB引擎

- 介绍：InnoDB引擎是一种兼顾高可靠性和高性能的通用存储引擎，在MySQL 5.5之后，InnoDB是默认的存储引擎。

- 特点：

    - DML（增删改）操作遵循ACID模型，支持**事务**；

    - **行级锁**，提高并发访问性能；

    - 支持**外键** foreing key约束，保证数据的完整性和正确性；

- 文件：**xxx.ibd**：xxx代表的是表名，innoDB引擎的每张表都会对应这样一个表空间文件，存储该表的表结构（frm、sdi）、数据和索引。

- InnoDB的逻辑存储结构：

![image.png](image/image7.png)



### MyISAM & Memory

MyISAM引擎：

- 介绍：MyISAM是MySQL早期的默认存储引擎。

- 特点：

    - 不支持事务、不支持外键

    - 支持表锁，不支持行锁

    - 访问速度快

- 文件：

    - xxx.sdi：存储表结构信息

    - xxx.MYD：存储数据

    - xxx.MYI：存储索引

Memory引擎：

- 介绍：Memory的表数据是存储在内存中的，由于受到硬件、或断电问题的影响，只能将这些表作为临时表或缓存作用。

- 特点：

    - 内存存放

    - hash索引（默认）

- 文件：

    - xxx.sdi：存储表结构信息



### 对比

|特点|InnoDB|MyISAM|
|-|-|-|
|存储限制|64TB|有|
|事务安全|支持|不支持|
|锁机制|行锁|表锁|
|支持外键|支持|不支持|
|B+tree索引|支持|支持|
|Hash索引|-|-|
|全文索引|支持（5.6版本以上）|支持|
|空间使用|高|低|
|内存使用|高|低|
|批量插入数据|低|高|



## 存储引擎选择

- InnoDB：是Mysal的默认存储引擎，支持事务、外键。如果应用对事务的完整性有比较高的要求，在并发条件下要求数据的一致性，数据操作除了插入和查询之外，还包含很多的更新、删除操作，那么InnoDB存储引擎是比较合适的选择。

- MyISAM：如果应用是以读操作和插入操作为主，只有很少的更新和删除操作，并且对事务的完整性、并发性要求不是很高，那么选择这个存储引擎是非常合适的。

- MEMORY：将所有数据保存在内存中，访问速度快，通常用于临时表及缓存。MEMORY的缺陷就是对表的大小有限制，太大的表无法缓存在内存中，而且无法保障数据的安全性。
